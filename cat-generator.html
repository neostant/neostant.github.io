<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Cat Generator</title>
    </head>
    <body style="background-color:#111;color:#FFF">
        <h1>Cat Generator</h1>
        <form>
            <input type="checkbox" id="lowquality" name="lowquality" checked>
            <label for="lowquality">low quality</label><br><br>

            <input type="radio" name="type" value="thumbs-up">
            <label>üëç</label> | 
            <input type="radio" name="type" value="thumbs-down">
            <label>üëé</label> | 
            <input type="radio" name="type" value="fire">
            <label>üî•</label> | 
            <input type="radio" name="type" value="heart">
            <label>‚ô•Ô∏è</label> |
            <input type="radio" name="type" value="heart-eyes">
            <label>üòç</label> | 
            <input type="radio" name="type" value="raised-eyebrow">
            <label>ü§®</label> | 
            <input type="radio" name="type" value="random" checked>
            <label>üîÄ</label><br>

            <br><input type="submit" value="New cat" /><br><br>
            
        </form>
    </body>
</html>

<script>

    var types = {
        ["thumbs-up"]: [
            '120/twitter/322/thumbs-up_1f44d.png',
            '120/apple/354/thumbs-up_1f44d.png'
        ],
        ["thumbs-down"]: [
            '120/twitter/322/thumbs-down_1f44e.png',
            '120/apple/354/thumbs-down_1f44e.png'
        ],
        ["fire"]: [
            '120/twitter/322/fire_1f525.png',
            '120/apple/354/fire_1f525.png'
        ],
        ["heart-eyes"]: [
            '120/twitter/322/smiling-face-with-heart-eyes_1f60d.png',
            '120/apple/354/smiling-face-with-heart-eyes_1f60d.png'
        ],
        ["heart"]: [
            '120/twitter/322/orange-heart_1f9e1.png',
            '120/twitter/322/purple-heart_1f49c.png',
            '120/twitter/322/blue-heart_1f499.png',
            '120/twitter/322/green-heart_1f49a.png',
            '120/twitter/322/yellow-heart_1f49b.png',
            '120/twitter/322/beating-heart_1f493.png',
        ],
        ["raised-eyebrow"]: [
            '120/twitter/322/face-with-raised-eyebrow_1f928.png',
            '120/apple/354/face-with-raised-eyebrow_1f928.png'
        ]
    }

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const lowquality = urlParams.get('lowquality');
    var type = urlParams.get('type');
    if (!lowquality) {
    document.getElementById('lowquality').checked = false;
    }
    if (type) {
    document.getElementsByName('type').forEach(function(radio) {
        if (radio.value == type) {
        radio.checked = true;
        }
    });
    }
    if (type=="random") {
        type = Object.keys(types)[Math.floor(Math.random() * Object.keys(types).length)];
    }

    const imageUrl = `https://corsproxy.io/?https://d2ph5fj80uercy.cloudfront.net/06/cat${Math.floor(5000**Math.random())}.jpg`;
    const img = new Image();

    fetch(imageUrl)
    .then(response => response.blob())
    .then(blob => {
        const imageUrl = URL.createObjectURL(blob);
        img.src = imageUrl;
        img.id = "cat"
        img.style = "margin-right: 10px;"
        document.body.appendChild(img);

        const canvas = document.createElement('canvas');
        canvas.id="canvas"
        const ctx = canvas.getContext('2d');
        img.onload = function() {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        let data = imageData.data;

        if (lowquality) {
            canvas.width /= Math.floor(5*Math.random()) + 1;
            canvas.height /= Math.floor(5*Math.random()) + 1;
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(img, 0, 0, canvas.width, canvas.height);
            imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);
            data = imageData.data;
        }

        ctx.putImageData(imageData, 0, 0);

        const emojiSize = Math.min(canvas.width, canvas.height) / 2;
        const emojiX = Math.random() * (canvas.width - emojiSize);
        const emojiY = Math.random() * (canvas.height - emojiSize);
        const emoji = new Image();
        emoji.src = 'https://corsproxy.io/?https://em-content.zobj.net/thumbs/' + types[type][Math.floor(Math.random() * types[type].length)];
        emoji.onload = function() {
            ctx.drawImage(emoji, emojiX, emojiY, emojiSize, emojiSize);
            document.body.appendChild(canvas);
        };
        };

        canvas.style.width = "256px"
        canvas.style.height = "256px"
        
    });

</script>
